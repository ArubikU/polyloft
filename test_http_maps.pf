// Test simple de HTTP con Maps de Polyloft

println("=== Test HTTP con Maps de Polyloft ===")

// Test 1: Verificar que el servidor se puede crear
let server = Http.createServer()
println("✓ Servidor creado")

// Test 2: Configurar servidor
server.config({cors: true, limit: "5MB"})
println("✓ Servidor configurado")

// Test 3: Middleware global
let globalCalled = false
server.use((req, res, next) => do
    globalCalled = true
    next()
end)
println("✓ Middleware global registrado")

// Test 4: Error handler
server.onError((err, req, res) => do
    println("Error capturado: #{err}")
    res.error(500, "Error interno")
end)
println("✓ Error handler registrado")

// Test 5: Rutas con respuestas shortcuts
server.get("/test-ok", (req, res) => do
    res.ok({message: "success", data: [1, 2, 3]})
end)
println("✓ Ruta /test-ok registrada")

server.post("/test-created", (req, res) => do
    res.created({id: 1, name: "nuevo"})
end)
println("✓ Ruta /test-created registrada")

server.delete("/test-nocontent", (req, res) => do
    res.noContent()
end)
println("✓ Ruta /test-nocontent registrada")

server.get("/test-notfound", (req, res) => do
    res.notFound("Recurso no encontrado")
end)
println("✓ Ruta /test-notfound registrada")

server.get("/test-error", (req, res) => do
    res.error(503, "Servicio no disponible")
end)
println("✓ Ruta /test-error registrada")

// Test 6: Ruta con middlewares específicos
def authMiddleware(req, res, next):
    println("Verificando autenticación...")
    next()
end

def logMiddleware(req, res, next):
    println("Logging request...")
    next()
end

server.get("/test-middleware", [authMiddleware, logMiddleware], (req, res) => do
    res.ok({message: "middleware test passed"})
end)
println("✓ Ruta con middlewares registrada")

// Test 7: Logging
server.log("Test de logging info")
server.log("Test de logging error", "error")
server.log("Test de logging debug", "debug")
println("✓ Sistema de logging funciona")

println("\n=== Todos los tests pasaron! ===")
println("\nPuedes iniciar el servidor con:")
println("  server.listen(8080)")
